trigger:
  branches:
    include:
    - nitishsharma/release-pipelines-1

pr: none

resources:
  repositories:
  - repository: self
    type: git
    ref: refs/heads/nitishsharma/release-pipelines-1

pool:
  vmImage: 'ubuntu-latest'

steps:
- task: NodeTool@0
  inputs:
    versionSpec: '14.x'
  displayName: 'Install Node.js'
- script: sudo npm install -g yarn
  displayName: 'install yarn'
- script: sudo chown -R $USER:$GROUP ~/.config
  displayName: 'fix filesystem permissions'
- script: yarn
  displayName: 'yarn'
- script: yarn run compile
  displayName: 'yarn compile'
- script: sudo npm install -g vsce
  displayName: 'install vsce'
- script: yarn run package
  displayName: 'yarn run package'
- script: yarn run package-offline
  displayName: 'yarn run package-offline'
- task: CopyFiles@2
  inputs:
    sourceFolder: '$(Build.SourcesDirectory)'
    contents: '*.vsix'
    targetFolder: '$(Build.ArtifactStagingDirectory)'
  displayName: 'copy files'
- task: PublishBuildArtifacts@1
  inputs:
    pathToPublish: '$(Build.ArtifactStagingDirectory)'
    artifactName: build
  displayName: 'publish artifacts'